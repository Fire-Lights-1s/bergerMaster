<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>발주 등록</title>

    <!-- 기본적인 외부 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css">

    <!-- 필수 스크립트 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

</head>
<body>
<section class="content">
  <div class="container-fluid col-sm-10 mt-5">
    <h1 class="m-0">발주 등록</h1>
    <div class="card insert-container px-3 py-3 mt-5">
        <div class="card-body basic-info-area px-5">
            <div class="form-group row">
                <label class="col-sm-2 col-form-label text-center" for="order_date">등록일</label>
                <div class="col-sm-4">
                    <input class="form-control" type="date" name="order_date" id="order_date" th:value="${today}">
                </div>
                <label class="col-sm-2 col-form-label text-center">담당자</label>
                <div class="input-group col-sm-4">
                    <input class="form-control" type="text" name="manager" placeholder="코드" th:value="${id}">
                    <div class="input-group-append">
                        <span id="find-manager" class="input-group-text" style="cursor:pointer;"><i class="fas fa-search"></i></span>
                    </div>
                    <input class="form-control" type="text" name="manager_name" placeholder="이름" th:value="${name}">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label text-center" for="due_date">거래처</label>
                <div class="input-group col-sm-4">
                    <input class="form-control" type="text" name="supplier" placeholder="코드">
                    <div class="input-group-append">
                        <span id="find-supplier" class="input-group-text" style="cursor:pointer;"><i class="fas fa-search"></i></span>
                    </div>
                    <input class="form-control" type="text" name="supplier_name" placeholder="상호">
                </div>
                <labal class="col-sm-2 col-form-label text-center">납기일</labal>
                <div class="col-sm-4">
                    <input class="form-control" type="date" id="due_date" name="due_date">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label text-center">비  고</label>
                <div class="col-sm-10">
                    <input class="form-control" type="text" name="manager">
                </div>
            </div>
        </div>
        <div class="input-items-area card-body">
            <div class="row">
                <button class="btn btn-md btn-primary ml-auto mr-2 mb-3" id="add-items">물품 추가</button>
            </div>
            <div class="item-list card-body border">
                <table class="table table-bordered table-hover dataTable dtr-inline">
                    <tr class="bg-lightblue">
                        <th></th>
                        <th class="text-center" style="width:15%;">품목코드</th>
                        <th class="text-center" style="width:35%;">품목명</th>
                        <th class="text-center" style="width:10%;">단가(원)</th>
                        <th class="text-center" style="width:15%;">수량(단위)</th>
                        <th class="text-center" style="width:15%;">소계(원)</th>
                    </tr>
                    <tr>
                        <td class="text-center"><button class="btn btn-danger btn-sm delete-this-row">X</button></td>
                        <td class="text-center">1</td>
                        <td class="text-center">샘플</td>
                        <td class="text-right">999,999</td>
                        <td class="text-center"><input class="col-sm-4" type="text" value="1"> (단위)</td>
                        <td class="text-right">999,999</td>
                    </tr>
                    <tr>
                        <td class="text-center"><button class="btn btn-danger btn-sm delete-this-row">X</button></td>
                        <td class="text-center">2</td>
                        <td class="text-center">샘플</td>
                        <td class="text-right">999,999</td>
                        <td class="text-center"><input class="col-sm-4" type="text" value="1"> (단위)</td>
                        <td class="text-right">999,999</td>
                    </tr>
                </table>
                <div class="calculating-brief row my-2 py-3 px-2 bg-light">
                    <div class="col-6 number-of-items"><span class="ml-3">2개 품목 선택</span></div>
                    <div class="col-6 text-right total-of-price"><span class="mr-2">금액 합계: 1,999,998원</span></div>
                </div>
            </div>
        </div>
    </div>
      <div class="submit-btn-area row">
          <button class="btn btn-lg btn-primary ml-auto my-3">발주 등록</button>
      </div>
  </div>
</section>

<script>

    // 마우스 포인터가 위치한 곳에 팝업창 띄우기
    function openPopupAtMousePosition(event, url, width, height) {
        // 마우스 위치
        const mouseX = event.screenX;
        const mouseY = event.screenY;
        // 팝업창 크기
        const popupWidth = width;
        const popupHeight = height;
        // 팝업창 위치계산
        const popupLeft = mouseX - (popupWidth / 2);
        const popupTop = mouseY - (popupHeight / 2);
        // 팝업창 열기
        window.open(url, 'popupWindow', `width=${popupWidth}, height=${popupHeight}, top=${popupTop}, left=${popupLeft}`);
    }

    // 담당자 검색 팝업
    $('#find-manager').on('click', function(event) {
        openPopupAtMousePosition(event, '/findManager', 600, 600)
    });

    // 팝업에서 선택한 담당자 폼에 입력


    // 거래처 검색 팝업
    $('#find-supplier').on('click', function(event) {
        openPopupAtMousePosition(event, '/findSupplier', 600, 600)
    });

    // 팝업에서 선택한 거래처 폼에 입력



    // 물품 추가 팝업
    $('#add-items').on('click', function(event) {
        openPopupAtMousePosition(event, '/addItems', 800, 600)
    });


    // 팝업에서 선택한 물품 목록(+히든 인풋)에 입력



    // 단가 * 수량 = 소계 자동 산출


    // 등록된 물품 지우기
    $('#delete-this-row').on('click', function(event) {

    });

    // 등록에 따른 총 품목개수, 합계금액 보여주기


    // 발주등록 버튼: 필수항목이 비어있으면 비활성화, 모두 채워지면 활성화
    // + 등록버튼 연타에 따른 중복등록 방지 (로더 넣기)


</script>

</body>

</html>